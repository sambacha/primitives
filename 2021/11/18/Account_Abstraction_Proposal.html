<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Account Abstraction via Alt. Mempool | Primitives</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Account Abstraction via Alt. Mempool" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Proposal for account abstraction via alternative mempool" />
<meta property="og:description" content="Proposal for account abstraction via alternative mempool" />
<meta property="og:site_name" content="Primitives" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-11-18T19:04:27+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Account Abstraction via Alt. Mempool" />
<script type="application/ld+json">
{"headline":"Account Abstraction via Alt. Mempool","dateModified":"2021-11-18T19:04:27+00:00","datePublished":"2021-11-18T19:04:27+00:00","url":"/primitives/2021/11/18/Account_Abstraction_Proposal.html","description":"Proposal for account abstraction via alternative mempool","mainEntityOfPage":{"@type":"WebPage","@id":"/primitives/2021/11/18/Account_Abstraction_Proposal.html"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link type="application/atom+xml" rel="alternate" href="/primitives/feed.xml" title="Primitives" /><!-- Emoji Favicon  -->
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÑ</text></svg>">
    <!-- <link rel="shortcut icon" href="/primitives/favicon.ico"> -->
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/primitives/assets/css/main.min.css">
</head>
<body><!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top invert">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <a class="navbar-brand" href="/primitives/">Primitives</a>
            <button class="navbar-toggle" type="button" >
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/primitives/">Home</a>
                    </li><li>
                        <a href="/primitives/about/">About</a>
                    </li><li>
                        <a href="/primitives/archive/">Archive</a>
                    </li><li class="search-icon">
                        <a href="javascript:void(0)">
                            <i class="fas fa-search"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>
<!-- Search -->
<div class="search-page">
    <div class="search-icon-close-container">
        <span class="search-icon-close">
            <i class="fas fa-chevron-down"></i>
        </span>
    </div>

    <div class="search-main container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <form>
                    <input type="text" id="search-input" placeholder="$ grep...">
                </form>
                <div id="search-results" class="mini-post-list"></div>
            </div>
        </div>
    </div>
</div>
<!-- Post Header --><header class="intro-header style-text">
    <div class="header-mask"></div><div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags"><a class="tag" href="/primitives/archive/?tag=ethereum" title="ethereum">ethereum</a><a class="tag" href="/primitives/archive/?tag=blockchain" title="blockchain">blockchain</a><a class="tag" href="/primitives/archive/?tag=eip" title="eip">eip</a><a class="tag" href="/primitives/archive/?tag=account+abstraction" title="account abstraction">account abstraction</a><a class="tag" href="/primitives/archive/?tag=proposal" title="proposal">proposal</a></div>
                    <h1>Account Abstraction via Alt. Mempool</h1>
                    <h2 class="subheading">Proposal for account abstraction via alternative mempool</h2>
                    <span class="meta">Posted by sambacha on November 18, 2021</span>
                </div>
            </div>
        </div>
    </div>
</header><!-- Post Content -->
<style>
    /* Place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position:    absolute;
            left:        -0.75em;
            font-size:   1.1em;
            margin-top : 0.1em;
        }
    }
</style>
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container"><h1 id="proposal-for-account-abstraction-via-alternative-mempool">Proposal for account abstraction via alternative mempool</h1>

<p>Account abstraction has for a long time been a goal in the Ethereum ecosystem. Account abstraction can allow users to send transactions from smart contract wallets (eg. social recovery wallets) just as easily as they can from regular externally-owned accounts (EOAs). Currently, this is difficult because only an EOA can initiate a transaction and pay for gas. Previous proposals (eg. EIP 86, EIP 2938) attempted to modify the rules to allow smart contracts to pay for gas, but required sophisticated rules to ensure that transactions that pass through the mempool actually are going to pay fees.</p>

<p>This proposal takes a different approach, inspired by (and implementable through) alternate mempools such as Flashbots. We create a separate mempool that contains not transactions, but packaged objects representing calls (which we call user operations). A miner that is compatible with this mempool would simply include one single transaction which packages and makes all of these calls. Implementing account abstraction inside an alternate mempool allows it to proceed in a low-risk way early on, and eventually it could be more closely enshrined into the protocol (or incorporated through a scheme such as proposer/block builder separation)</p>

<p>User operation format
User operations are passed around the network as an SSZ object of the form:</p>

<pre><code class="language-solidity=">class UserOperation(Container):
    target: Address # bytes32
    gas: uint64
    calldata: bytes
</code></pre>

<p>calldata itself encodes a struct that contains the desired operation that the user wants to make, but the implementation of this is up to the individual smart contract wallet (eg. it could represent an instruction to make one call, or make multiple calls, or perform some key-changing operation in the wallet).</p>

<p>Wallet format template
Smart contract wallets are expected to have code fitting the following template:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="rouge-code"><pre>
<span class="nx">CALLDATA_OFFSET</span> <span class="o">=</span> <span class="mi">160</span>
<span class="nx">MAX_CHECK_GAS</span> <span class="o">=</span> <span class="mi">200000</span>
<span class="nx">RESERVED_FEE_POS</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nx">GASPRICE_POS</span> <span class="o">=</span> <span class="mi">32</span>
<span class="nx">POST_CALL_GAS_POS</span> <span class="o">=</span> <span class="mi">64</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">MULTI_SENDER_ADDRESS</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mstore</span><span class="p">(</span><span class="nx">CALLDATA_OFFSET</span> <span class="o">-</span> <span class="mi">32</span><span class="p">,</span> <span class="nx">gas</span><span class="p">())</span>
    <span class="nx">calldatacopy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">CALLDATA_OFFSET</span><span class="p">,</span> <span class="nx">calldatasize</span><span class="p">())</span>
    <span class="err">#</span> <span class="nx">Self</span><span class="o">-</span><span class="nx">call</span> <span class="nx">to</span> <span class="nx">check</span> <span class="nx">nonce</span> <span class="nx">and</span> <span class="nx">signature</span>
    <span class="err">#</span> <span class="nx">Self</span><span class="o">-</span><span class="nx">call</span> <span class="nx">output</span> <span class="nx">expected</span> <span class="nx">to</span> <span class="nx">be</span><span class="p">:</span>
    <span class="err">#</span> <span class="p">[</span><span class="nx">reserved_fee</span><span class="p">]</span> <span class="p">[</span><span class="nx">gasprice</span><span class="p">]</span> <span class="p">[</span><span class="nx">post_call_gas</span><span class="p">]</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">staticcall</span><span class="p">(</span>
        <span class="nx">address</span><span class="p">(),</span> <span class="nx">MAX_CHECK_GAS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">CALLDATA_OFFSET</span> <span class="o">-</span> <span class="mi">32</span><span class="p">,</span> <span class="nx">calldatasize</span><span class="p">()</span> <span class="o">+</span> <span class="mi">32</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span> <span class="nx">CALLDATA_OFFSET</span>
    <span class="p">))</span>
    <span class="err">#</span> <span class="nx">Send</span> <span class="nx">reserved</span> <span class="nx">fee</span>
    <span class="nx">call</span><span class="p">(</span><span class="nx">FEE_RESERVER_ADDRESS</span><span class="p">,</span> <span class="nx">mload</span><span class="p">(</span><span class="nx">RESERVED_FEE_POS</span><span class="p">))</span>
    <span class="err">#</span> <span class="nx">Self</span><span class="o">-</span><span class="nx">call</span> <span class="nx">to</span> <span class="k">do</span> <span class="nx">main</span> <span class="nx">call</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">[</span><span class="nx">and</span> <span class="nx">increment</span> <span class="nx">the</span> <span class="nx">nonce</span><span class="p">]</span>
    <span class="nx">mstore</span><span class="p">(</span><span class="nx">CALLDATA_OFFSET</span> <span class="o">-</span> <span class="mi">32</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="nx">call</span><span class="p">(</span>
        <span class="nx">address</span><span class="p">(),</span> <span class="nx">gas</span><span class="p">()</span> <span class="o">-</span> <span class="nx">mload</span><span class="p">(</span><span class="nx">POST_CALL_GAS_POS</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">CALLDATA_OFFSET</span> <span class="o">-</span> <span class="mi">32</span><span class="p">,</span> <span class="nx">calldatasize</span><span class="p">()</span> <span class="o">+</span> <span class="mi">32</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span> <span class="nx">CALLDATA_OFFSET</span>
    <span class="p">)</span>
    <span class="err">#</span> <span class="nx">Ask</span> <span class="k">for</span> <span class="nx">refund</span> <span class="p">(</span><span class="nx">non</span><span class="o">-</span><span class="nx">refunded</span> <span class="nx">gas</span> <span class="nx">fee</span> <span class="nx">gets</span> <span class="nx">sent</span> <span class="nx">to</span> <span class="nx">parent</span> <span class="nx">sender</span><span class="p">)</span>
    <span class="nx">call</span><span class="p">(</span><span class="nx">FEE_RESERVER_ADDRESS</span><span class="p">,</span> <span class="nx">GASPRICE_POS</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">!=</span> <span class="nx">address</span><span class="p">())</span> <span class="p">{</span>
    <span class="err">#</span> <span class="nx">Accept</span> <span class="nx">ETH</span> <span class="nx">and</span> <span class="k">do</span> <span class="nx">nothing</span>
    <span class="k">return</span><span class="p">()</span>
<span class="p">}</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">calldataload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="err">#</span> <span class="nx">The</span> <span class="nx">first</span> <span class="nx">value</span> <span class="k">in</span> <span class="nx">calldata</span> <span class="k">of</span> <span class="nx">a</span> <span class="nb">self</span><span class="o">-</span><span class="nx">call</span> <span class="nx">flags</span> <span class="nx">whether</span> <span class="nx">we</span><span class="dl">'</span><span class="s1">re doing signature-checking or performing an action
    ...
}
else {
    ...
}
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>This is a template that nodes in the network could check against; they would only accept a UserOperation whose target has code that satisfies this template. Additionally, they would require that the if (calldataload(0) != -1) clause in the code must pass a purity check, with the exception that local SLOADs are allowed.</p>

<p>The template ensures the following properties:</p>

<p>Only a user operation that passes through the wallet can take funds out of the wallet
Only a user operation that passes through the wallet can cause other user operations to no longer be able to process
Nodes in the network can halt execution right after the staticcall and check memory to see what the reserved fee and gasprice is, and make sure those values are acceptable
These properties are sufficient to make it safe for network nodes to propagate user operations the pass a check of executing past the staticcall and stopping there, and for miners to accept such user operations.</p>

<p>Network node and miner logic
Network nodes would listen for UserOperation objects on a dedicated subnet. They would verify a UserOperation by running it locally as a call, from their address, until the execution passes the staticcall stage. At that point, they would take the reserved_fee and compute implied_gasprice = reserved_fee / (user_operation.gas + 16 * calldatasize() + 2500), and check that gasprice &lt;= implied_gasprice. They would check:</p>

<p>That the staticcall passes
That the implied_gasprice - basefee is an acceptably high premium
That post_call_gas is sufficient to do the post-call fee refunding
If all checks pass, then as a network node they would propagate the UserOperation and as a miner they would consider it for inclusion.</p>

<p>When a new block appears, only UserOperations whose target were the target of any UserOperation would need to be re-checked (so a theoretical maximum of gas_limit / 5000 accounts).</p>

<p>When a miner packages a block, they would set the first transaction to be a transaction to the MULTI_SENDER_ADDRESS, a specialized contract. They would pass as calldata all the UserOperations, which the MULTI_SENDER_ADDRESS would then process. At the end, the MULTI_SENDER_ADDRESS would claim all fees and pass them along to the miner. Alternatively, bundle proposers in protocols such as Flashbots could produce such a transaction, allowing any Flashbots-compatible miner to include it in their block.</p>

<h2 id="account-abstraction-designs">Account abstraction designs</h2>

<p>These account abstraction designs attempt to optimize for the following goals:</p>

<p>Easy to determine if a transaction will pay gas (can just eth_call, no EVM modifications required)
Preserve existing mempool invariants, particuarly the rule that whether or not a given user operation will pay a fee if included depends only on the state of that account (and if desired on immutable libraries), not on other accounts. Since a maximum of 15m/5k = 3k accounts can be modified, this means that a maximum of 3k transactions need to have their validation reprocessed when a block appears
Support real time contract creation (so you can send an op from a wallet contract that doesn‚Äôt have code published yet, as long as it has ETH for gas)
Support sponsorship, where a contract pays for gas</p>

<h4 id="proposal-1-user-contract-wallet-with-self-call">Proposal 1: user contract wallet with self-call</h4>

<p>A user wallet is a contract, which is required to satisfy the following template (these checks are made off-chain by miners):</p>

<p>The wallet contains at least two functions, the checker and the main body (it can also contain other functions)
The main body logic is:
Pass the op into the checker as a static call
If the checker responds without an error, set sstore(0, sload(0) + 1) and interpret the checker response as (prepayment, gasprice)
Send prepayment + gasprice * msg.gas WETH to the refund handler (using WETH instead of ETH for gas efficiency; if the account doesn‚Äôt have WETH, auto-convert ETH)
Make the underlying user op (if there is insufficient ETH, auto-convert WETH), providing msg.gas - POST_CALL_GAS gas
Ask the refund handler to give a refund, depending on how much gas remains
Exit
The miner must check that the template is satisfied, and that the checker accesses only the storage of the wallet account itself (this is checked using code static analysis). To check a user operation, the miner calls the checker function, and verify that its response is acceptable (the gasprice is high enough, and the prepayment is high enough to cover gas used up until the fee transfer). If the wallet contract does not yet exist, then the user op object is required to contain the wallet contract code, and the prepayment must be higher; it‚Äôs the miner‚Äôs job to include a call creating the wallet contract right before the call to the wallet contract.</p>

<p>[Note: no sponsorship support yet]</p>

<h4 id="proposal-2-singleton-mechanism">Proposal 2: singleton mechanism</h4>

<p>Proposal 2 moves more of the logic into a central ‚Äúsingleton contract‚Äù. The miner must still code-check the check+pay function to verify that it does nothing other than (i) making a check that only touches the wallet‚Äôs own storage, and (ii) appropriately paying the refund handler, but it does not need to code-check everything else.</p>

<p>The execution flow is modified: first perform all the checks+payments, then execute all the ops. This ensures that no op can interfere with the success of a check+pay (if the miner is honest), because all the check+pay steps happen before the ops.</p>

<p>If the miner is not honest, then the worst that will happen is that the miner will not get paid. To ensure safety for users, wallet contracts should only allow the singleton to call check+pay and the main body.</p>

<p>To support contract creation, we can add a creation phase to the singleton before the verify+pay phase.</p>

<p>[Note: no sponsorship support yet]</p>



                <!-- Post Pager -->
                <div>
                    <hr style="visibility: hidden;">
                    <ul class="pager"><li class="previous">
                            <a href="/primitives/2021/11/15/Harm_Reduction_for_miners.html" data-toggle="tooltip" data-placement="top" title="harm reduction for miners">
                                Previous<br>
                                <span>harm reduction for miners</span>
                            </a>
                        </li></ul>
                    <hr style="visibility: hidden;">
                </div><!-- Comments -->
<script src="https://utteranc.es/client.js"
        repo="sambacha/comments"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script></div><!-- Side Catalog Container -->
            <div class="col-lg-2 col-lg-offset-0 visible-lg-block sidebar-container catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div><!-- Sidebar Container -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 sidebar-container"><!-- Featured Tags -->
<section><hr class="hidden-sm hidden-xs"><h5>
        <a href="/primitives/archive/">FEATURED TAGS</a>
    </h5>
    <div class="tags"><a data-sort="0001"
            href="/primitives/archive/?tag=blockchain"
            title="blockchain"
            rel="5">blockchain</a><a data-sort="0001"
            href="/primitives/archive/?tag=ethereum"
            title="ethereum"
            rel="5">ethereum</a><a data-sort="0002"
            href="/primitives/archive/?tag=distributed+computing"
            title="distributed computing"
            rel="4">distributed computing</a><a data-sort="0004"
            href="/primitives/archive/?tag=dao"
            title="dao"
            rel="2">dao</a><a data-sort="0004"
            href="/primitives/archive/?tag=governance"
            title="governance"
            rel="2">governance</a><a data-sort="0005"
            href="/primitives/archive/?tag=Jekyll"
            title="Jekyll"
            rel="1">Jekyll</a><a data-sort="0005"
            href="/primitives/archive/?tag=Markdown"
            title="Markdown"
            rel="1">Markdown</a><a data-sort="0005"
            href="/primitives/archive/?tag=account+abstraction"
            title="account abstraction"
            rel="1">account abstraction</a><a data-sort="0005"
            href="/primitives/archive/?tag=eip"
            title="eip"
            rel="1">eip</a><a data-sort="0005"
            href="/primitives/archive/?tag=flashbots"
            title="flashbots"
            rel="1">flashbots</a><a data-sort="0005"
            href="/primitives/archive/?tag=mev"
            title="mev"
            rel="1">mev</a><a data-sort="0005"
            href="/primitives/archive/?tag=proposal"
            title="proposal"
            rel="1">proposal</a>
    </div>
</section>
</div>
        </div>
    </div>
</article>
<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><!-- SNS -->
<ul class="list-inline text-center">
    
    <li>
        <a href="/primitives/feed.xml">
            <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
            </span>
        </a>
    </li><li>
        <a target="_blank" href="mailto:sam@manifoldfinance.com">
            <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
            </span>
        </a>
    </li><li>
        <a target="_blank" href="https://github.com/sambacha">
            <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fab fa-github fa-stack-2x"></i>
            </span>
        </a>
    </li></ul>
<p class="copyright text-muted">See <a href="https://github.com/sambacha"></a> @sambacha | &copy; 2021 sambacha
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>

<!-- Bootstrap JavaScript-->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<!-- Simple Jekyll Search -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/simple-jekyll-search/1.7.12/simple-jekyll-search.min.js" integrity="sha512-APy7Ff/y4pdIHleqiTMcRZ8Wu6tjfqhJpgAcaCvTuFQPj/G+/A5u0uZi/DkfkuLQ6FeFmDJgh/zl0y3If/VUyA==" crossorigin="anonymous"></script>

<!-- MathJax https://github.com/mathjax/MathJax/issues/2220 -->
<script>
    MathJax = {
        options: {
            renderActions: {
                /* add a new named action not to override the original 'find' action */
                find_script_mathtex: [10, function (doc) {
                    for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                        const display = !!node.type.match(/; *mode=display/);
                        const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                        const text = document.createTextNode('');
                        node.parentNode.replaceChild(text, node);
                        math.start = { node: text, delim: '', n: 0 };
                        math.end = { node: text, delim: '', n: 0 };
                        doc.math.push(math);
                    }
                }, '']
            }
        }
    };
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.0.5/es5/tex-chtml.js" integrity="sha512-WIPUeuVusAT6dUtN6xKArYCBEa76ltyvaz3ltvQd+dy7ISdGJv1Y3y7eDBEF986YfNtmZGLdAaEBSgeBb+8OSg==" crossorigin="anonymous"></script>

<!-- Async load function -->
<script>
    function async(u, c) {
        var d = document,
            t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script><!-- AnchorJS -->
<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js", function() {
        anchors.options = {
            visible: 'hover'
        };
    anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    });
</script><!-- Custom JavaScript -->
<script src="/primitives/assets/js/main.js"></script><!-- Side Catalog -->
<script src="/primitives/assets/js/catalog.js"></script></body>
</html>
